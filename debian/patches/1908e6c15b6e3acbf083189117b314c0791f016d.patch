From 1908e6c15b6e3acbf083189117b314c0791f016d Mon Sep 17 00:00:00 2001
From: Christine Caulfield <ccaulfie@redhat.com>
Date: Tue, 22 Sep 2015 09:58:23 +0100
Subject: [PATCH] Fix deletion of sockets on *BSD platforms

The code removed the last 8 characters of a socket name
to get the 'base name', but 9 are needed.

Signed-off-by: Christine Caulfield <ccaulfie@redhat.com>
---
 lib/ipc_socket.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/ipc_socket.c b/lib/ipc_socket.c
index ef97041..c02dd4c 100644
--- a/lib/ipc_socket.c
+++ b/lib/ipc_socket.c
@@ -301,7 +301,7 @@ qb_ipcc_us_disconnect(struct qb_ipcc_connection *c)
 #if !(defined(QB_LINUX) || defined(QB_CYGWIN))
     if (getsockname(c->response.u.us.sock, (struct sockaddr *)&un_addr, &un_addr_len) == 0) {
       length = strlen(un_addr.sun_path);
-      base_name = strndup(un_addr.sun_path,length-8);
+      base_name = strndup(un_addr.sun_path,length-9);
       qb_util_log(LOG_DEBUG, "unlinking socket bound files with base_name=%s length=%d",base_name,length);
       snprintf(sock_name,PATH_MAX,"%s-%s",base_name,"request");
       qb_util_log(LOG_DEBUG, "unlink sock_name=%s",sock_name);
